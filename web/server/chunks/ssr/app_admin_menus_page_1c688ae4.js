module.exports=[58546,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(65233);function f(){let a=(0,d.useRouter)(),[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)(!0),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)({title:"",url:"",page_id:"",course_id:"",news_id:"",parent_id:"",sort_order:0,is_active:1,link_type:"url"}),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(new Set),[B,C]=(0,c.useState)(1);(0,c.useEffect)(()=>{D()},[]);let D=async()=>{(await fetch("/web/api/auth/me")).ok?(q(!1),E()):a.push("/admin/login")},E=async()=>{let[a,b,c,d]=await Promise.all([fetch("/web/api/menus"),fetch("/web/api/pages"),fetch("/web/api/courses"),fetch("/web/api/news")]),e=await a.json(),f=await b.json(),h=await c.json(),j=await d.json();g(e.menus||[]),i(e.allMenus||[]),k(f.pages||[]),m(h.courses||[]),o(j.news||[])},F=a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},G=async(a,b,c)=>{if(a.preventDefault(),!x||x.id===b.id)return;let d=async(a,c)=>{let d=[...c],e=d.findIndex(a=>a.id===x.id);d.findIndex(a=>a.id===b.id),-1!==e&&d.splice(e,1);let f=d.findIndex(a=>a.id===b.id);d.splice(f,0,x);let g=d.map((a,b)=>({id:a.id,sort_order:b}));x.parent_id,await fetch("/web/api/menus",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({updates:g})}),E()},e=(a,b)=>{for(let c of a){if(c.id===b)return a;if(c.children&&c.children.length>0){let a=e(c.children,b);if(a)return a}}return null},g=e(f,b.id);g&&await d(c,g)},H=a=>{y(null),a.currentTarget.classList.remove("dragging"),document.querySelectorAll(".menu-tree-item").forEach(a=>a.classList.remove("drag-over"))},I=a=>{a.preventDefault(),a.currentTarget.classList.contains("menu-tree-item")&&a.currentTarget.classList.add("drag-over")},J=a=>{a.preventDefault(),a.currentTarget.classList.remove("drag-over")},K=(a=null)=>{u(null),w({title:"",url:"",page_id:"",course_id:"",news_id:"",parent_id:a||"",sort_order:0,is_active:1,link_type:"url"}),s(!0)},L=async()=>{let a={title:v.title,url:"url"===v.link_type?v.url:null,page_id:"page"===v.link_type&&v.page_id||null,course_id:"course"===v.link_type&&v.course_id||null,news_id:"news"===v.link_type&&v.news_id||null,parent_id:v.parent_id||null,sort_order:parseInt(v.sort_order)||0,is_active:+!!v.is_active};t?await fetch(`/web/api/menus/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}):await fetch("/web/api/menus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),s(!1),E()},M=async a=>{confirm("ยืนยันการลบเมนูนี้? (sub-menu จะถูกลบด้วย)")&&(await fetch(`/web/api/menus/${a}`,{method:"DELETE"}),E())},N=(a,c=0,d=null)=>a.map(a=>(0,b.jsxs)("div",{className:"menu-tree-node",children:[(0,b.jsxs)("div",{className:`menu-tree-item depth-${c} ${x?.id===a.id?"dragging":""}`,style:{paddingLeft:`${20+32*c}px`},draggable:!0,onDragStart:b=>{y(a),b.dataTransfer.effectAllowed="move",b.currentTarget.classList.add("dragging")},onDragOver:F,onDragEnter:I,onDragLeave:J,onDrop:b=>G(b,a,d),onDragEnd:H,children:[(0,b.jsx)("div",{className:"menu-tree-handle",children:(0,b.jsx)("span",{className:"material-icons",children:"drag_indicator"})}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[a.children&&a.children.length>0&&(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void A(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})},className:"flex items-center justify-center w-6 h-6 rounded hover:bg-white/10 transition-colors",children:(0,b.jsx)("span",{className:`material-icons text-sm transition-transform duration-200 ${z.has(a.id)?"-rotate-90":""}`,children:"expand_more"})}),!a.children||0===a.children.length&&c>0&&(0,b.jsx)("span",{className:"w-6"}),(0,b.jsxs)("div",{className:"menu-tree-info",children:[(0,b.jsx)("span",{className:`menu-status ${a.is_active?"active":"inactive"}`}),(0,b.jsx)("span",{className:"menu-tree-title font-bold",children:a.title}),(0,b.jsx)("span",{className:"menu-tree-url opacity-50 text-xs",children:a.page_id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"material-icons",style:{fontSize:12},children:"article"})," ",a.page_title||"เพจ"]}):a.course_id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"material-icons",style:{fontSize:12},children:"school"})," ",a.course_title||"หลักสูตร"]}):a.news_id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"material-icons",style:{fontSize:12},children:"newspaper"})," ",a.news_title||"ข่าวสาร"]}):a.url||"—"})]})]}),(0,b.jsxs)("div",{className:"menu-tree-actions",children:[(0,b.jsx)("button",{className:"btn-icon btn-add-sub",title:"เพิ่ม sub-menu",onClick:()=>K(a.id),children:(0,b.jsx)("span",{className:"material-icons",children:"add"})}),(0,b.jsx)("button",{className:"btn-icon btn-edit",title:"แก้ไข",onClick:()=>{let b;return u(a),b="url",void(a.page_id?b="page":a.course_id?b="course":a.news_id&&(b="news"),w({title:a.title,url:a.url||"",page_id:a.page_id||"",course_id:a.course_id||"",news_id:a.news_id||"",parent_id:a.parent_id||"",sort_order:a.sort_order||0,is_active:a.is_active,link_type:b}),s(!0))},children:(0,b.jsx)("span",{className:"material-icons",children:"edit"})}),(0,b.jsx)("button",{className:"btn-icon btn-delete",title:"ลบ",onClick:()=>M(a.id),children:(0,b.jsx)("span",{className:"material-icons",children:"delete"})})]})]}),a.children&&a.children.length>0&&!z.has(a.id)&&(0,b.jsx)("div",{className:"menu-tree-children",children:N(a.children,c+1,a.id)})]},a.id)),O=f.slice((B-1)*10,10*B),P=Math.ceil(f.length/10);return p?(0,b.jsxs)("div",{className:"admin-loading",children:[(0,b.jsx)("div",{className:"admin-loading-spinner"}),(0,b.jsx)("p",{children:"กำลังโหลด..."})]}):(0,b.jsxs)("div",{className:"admin-layout",children:[(0,b.jsx)(e.default,{}),(0,b.jsxs)("div",{className:"admin-content",children:[(0,b.jsxs)("header",{className:"admin-header",children:[(0,b.jsxs)("div",{className:"admin-header-left",children:[(0,b.jsx)("h1",{className:"text-xl font-bold text-white",children:"จัดการเมนู"}),(0,b.jsx)("p",{className:"text-sm text-white/50",children:"ลากวางเพื่อจัดลำดับเมนู และจัดการเมนูย่อย"})]}),(0,b.jsx)("div",{className:"admin-header-right",children:(0,b.jsxs)("button",{className:"btn-primary",onClick:()=>K(),children:[(0,b.jsx)("span",{className:"material-icons",children:"add"})," เพิ่มเมนูใหม่"]})})]}),(0,b.jsx)("main",{className:"admin-main",children:0===f.length?(0,b.jsxs)("div",{className:"empty-state",children:[(0,b.jsx)("span",{className:"material-icons",children:"menu_open"}),(0,b.jsx)("h3",{children:"ยังไม่มีเมนู"}),(0,b.jsx)("p",{children:"สร้างเมนูแรกเพื่อใช้ในเว็บไซต์"}),(0,b.jsxs)("button",{className:"btn-primary",onClick:()=>K(),children:[(0,b.jsx)("span",{className:"material-icons",children:"add"})," เพิ่มเมนูใหม่"]})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"menu-tree-container bg-white/5 rounded-2xl border border-white/10 overflow-hidden",children:[(0,b.jsxs)("div",{className:"menu-tree-header grid grid-cols-[1fr_auto] px-6 py-4 bg-white/5 border-b border-white/10 text-xs font-bold uppercase tracking-wider text-white/40",children:[(0,b.jsx)("span",{children:"ชื่อเมนู / ข้อมูล"}),(0,b.jsx)("span",{className:"text-right",children:"จัดการ"})]}),(0,b.jsx)("div",{className:"divide-y divide-white/5",children:N(O,0,null)})]}),P>1&&(0,b.jsxs)("div",{className:"flex items-center justify-between px-2",children:[(0,b.jsxs)("p",{className:"text-sm text-white/40",children:["แสดง ",(B-1)*10+1," - ",Math.min(10*B,f.length)," จากทั้งหมด ",f.length," เมนูหลัก"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>C(a=>Math.max(1,a-1)),disabled:1===B,className:"px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-white hover:bg-white/10 disabled:opacity-30 transition-all flex items-center gap-2",children:[(0,b.jsx)("span",{className:"material-icons text-sm",children:"chevron_left"}),"ก่อนหน้า"]}),(0,b.jsx)("div",{className:"flex gap-1",children:[...Array(P)].map((a,c)=>(0,b.jsx)("button",{onClick:()=>C(c+1),className:`w-10 h-10 rounded-xl flex items-center justify-center font-bold transition-all ${B===c+1?"bg-primary text-secondary":"bg-white/5 border border-white/10 text-white hover:bg-white/10"}`,children:c+1},c))}),(0,b.jsxs)("button",{onClick:()=>C(a=>Math.min(P,a+1)),disabled:B===P,className:"px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-white hover:bg-white/10 disabled:opacity-30 transition-all flex items-center gap-2",children:["ถัดไป",(0,b.jsx)("span",{className:"material-icons text-sm",children:"chevron_right"})]})]})]})]})})]}),r&&(0,b.jsx)("div",{className:"modal-overlay",onClick:()=>s(!1),children:(0,b.jsxs)("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"modal-header",children:[(0,b.jsx)("h3",{children:t?"แก้ไขเมนู":"เพิ่มเมนูใหม่"}),(0,b.jsx)("button",{className:"modal-close",onClick:()=>s(!1),children:(0,b.jsx)("span",{className:"material-icons",children:"close"})})]}),(0,b.jsxs)("div",{className:"modal-body",children:[(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{children:"ชื่อเมนู"}),(0,b.jsx)("input",{value:v.title,onChange:a=>w({...v,title:a.target.value}),placeholder:"เช่น หน้าแรก, เกี่ยวกับเรา"})]}),(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{children:"เมนูหลัก (Parent)"}),(0,b.jsxs)("select",{value:v.parent_id,onChange:a=>w({...v,parent_id:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"— ไม่มี (เป็นเมนูหลัก) —"}),h.filter(a=>!t||a.id!==t.id).map(a=>(0,b.jsx)("option",{value:a.id,children:a.title},a.id))]})]}),(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{children:"ประเภทลิงก์"}),(0,b.jsxs)("div",{className:"radio-group",children:[(0,b.jsxs)("label",{className:`radio-label ${"url"===v.link_type?"active":""}`,children:[(0,b.jsx)("input",{type:"radio",name:"link_type",value:"url",checked:"url"===v.link_type,onChange:()=>w({...v,link_type:"url"})}),(0,b.jsx)("span",{className:"material-icons",children:"link"})," URL"]}),(0,b.jsxs)("label",{className:`radio-label ${"page"===v.link_type?"active":""}`,children:[(0,b.jsx)("input",{type:"radio",name:"link_type",value:"page",checked:"page"===v.link_type,onChange:()=>w({...v,link_type:"page"})}),(0,b.jsx)("span",{className:"material-icons",children:"article"})," เลือกเพจ"]}),(0,b.jsxs)("label",{className:`radio-label ${"course"===v.link_type?"active":""}`,children:[(0,b.jsx)("input",{type:"radio",name:"link_type",value:"course",checked:"course"===v.link_type,onChange:()=>w({...v,link_type:"course"})}),(0,b.jsx)("span",{className:"material-icons",children:"school"})," เลือกหลักสูตร"]}),(0,b.jsxs)("label",{className:`radio-label ${"news"===v.link_type?"active":""}`,children:[(0,b.jsx)("input",{type:"radio",name:"link_type",value:"news",checked:"news"===v.link_type,onChange:()=>w({...v,link_type:"news"})}),(0,b.jsx)("span",{className:"material-icons",children:"newspaper"})," เลือกข่าวสาร"]})]})]}),"url"===v.link_type?(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{children:"URL"}),(0,b.jsx)("input",{value:v.url,onChange:a=>w({...v,url:a.target.value}),placeholder:"https://example.com หรือ #section"})]}):"page"===v.link_type?(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{children:"เลือกเพจ"}),(0,b.jsxs)("select",{value:v.page_id,onChange:a=>w({...v,page_id:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"— เลือกเพจ —"}),j.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.title," (/",a.slug,")"]},a.id))]})]}):"course"===v.link_type?(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{children:"เลือกหลักสูตร"}),(0,b.jsxs)("select",{value:v.course_id,onChange:a=>w({...v,course_id:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"— เลือกหลักสูตร —"}),l.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.title," (",a.slug,")"]},a.id))]})]}):(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{children:"เลือกข่าวสาร/กิจกรรม"}),(0,b.jsxs)("select",{value:v.news_id,onChange:a=>w({...v,news_id:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"— เลือกข่าวสาร —"}),n.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.title," (",a.slug,")"]},a.id))]})]}),(0,b.jsxs)("div",{className:"form-row",children:[(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{children:"ลำดับ"}),(0,b.jsx)("input",{type:"number",value:v.sort_order,onChange:a=>w({...v,sort_order:a.target.value})})]}),(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{children:"สถานะ"}),(0,b.jsxs)("select",{value:v.is_active,onChange:a=>w({...v,is_active:parseInt(a.target.value)}),children:[(0,b.jsx)("option",{value:1,children:"เปิดใช้งาน"}),(0,b.jsx)("option",{value:0,children:"ปิดใช้งาน"})]})]})]})]}),(0,b.jsxs)("div",{className:"modal-footer",children:[(0,b.jsx)("button",{className:"btn-secondary",onClick:()=>s(!1),children:"ยกเลิก"}),(0,b.jsxs)("button",{className:"btn-primary",onClick:L,disabled:!v.title,children:[(0,b.jsx)("span",{className:"material-icons",children:"save"}),t?"บันทึก":"เพิ่มเมนู"]})]})]})})]})}a.s(["default",()=>f])}];

//# sourceMappingURL=app_admin_menus_page_1c688ae4.js.map