{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo11/Desktop/xx/spicc.ac.th-main/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\r\n// Ensure mysql2 is used as a server-only package\r\n\r\nlet pool = global.dbPool || null;\r\n\r\nfunction getPool() {\r\n    if (!pool) {\r\n        pool = mysql.createPool({\r\n            host: process.env.DB_HOST,\r\n            user: process.env.DB_USER,\r\n            password: process.env.DB_PASSWORD,\r\n            database: process.env.DB_NAME,\r\n            port: parseInt(process.env.DB_PORT || '3306'),\r\n            waitForConnections: true,\r\n            connectionLimit: 10,\r\n            queueLimit: 0,\r\n            connectTimeout: 30000,\r\n            enableKeepAlive: true,\r\n            keepAliveInitialDelay: 0,\r\n            charset: 'utf8mb4',\r\n        });\r\n        global.dbPool = pool;\r\n    }\r\n    return pool;\r\n}\r\n\r\nexport async function query(sql, params = []) {\r\n    const pool = getPool();\r\n    const [rows] = await pool.execute(sql, params);\r\n    return rows;\r\n}\r\n\r\nexport default getPool;\r\n"],"names":[],"mappings":";;;;;;AAAA;;AACA,iDAAiD;AAEjD,IAAI,OAAO,yDAAO,MAAM,IAAI;AAE5B,SAAS;IACL,IAAI,CAAC,MAAM;QACP,OAAO,mLAAK,CAAC,UAAU,CAAC;YACpB,MAAM,QAAQ,GAAG,CAAC,OAAO;YACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;YACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;YACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;YAC7B,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;YACtC,oBAAoB;YACpB,iBAAiB;YACjB,YAAY;YACZ,gBAAgB;YAChB,iBAAiB;YACjB,uBAAuB;YACvB,SAAS;QACb;QACA,yDAAO,MAAM,GAAG;IACpB;IACA,OAAO;AACX;AAEO,eAAe,MAAM,GAAG,EAAE,SAAS,EAAE;IACxC,MAAM,OAAO;IACb,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,OAAO,CAAC,KAAK;IACvC,OAAO;AACX;uCAEe"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo11/Desktop/xx/spicc.ac.th-main/app/api/news/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { query } from '@/lib/db';\nimport { revalidatePath } from 'next/cache';\n\nexport async function GET(request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const slug = searchParams.get('slug');\n\n    if (slug) {\n      const result = await query('SELECT * FROM cms_news WHERE slug = ?', [slug]);\n      return NextResponse.json({ success: true, news: result[0] });\n    }\n\n    const news = await query('SELECT * FROM cms_news ORDER BY created_at DESC');\n    return NextResponse.json({ success: true, news });\n  } catch (error) {\n    console.error(\"GET News Error:\", error);\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\n  }\n}\n\nexport async function POST(request) {\n  try {\n    const body = await request.json();\n    const { title, slug, description, gallery, date, category, image, is_featured } = body;\n\n    const result = await query(\n      'INSERT INTO cms_news (title, slug, description, gallery, date, category, image, is_featured) VALUES (?, ?, ?, ?, ?, ?, ?, ?)',\n      [title, slug || '', description, gallery || '[]', date, category, image, is_featured]\n    );\n\n    revalidatePath('/');\n    return NextResponse.json({ success: true, message: 'Added successfully', id: result.insertId });\n  } catch (error) {\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\n  }\n}\n\nexport async function PUT(request) {\n  try {\n    const body = await request.json();\n    const { id, title, slug, description, gallery, date, category, image, is_featured } = body;\n\n    await query(\n      'UPDATE cms_news SET title=?, slug=?, description=?, gallery=?, date=?, category=?, image=?, is_featured=? WHERE id=?',\n      [title, slug || '', description, gallery || '[]', date, category, image, is_featured, id]\n    );\n\n    revalidatePath('/');\n    return NextResponse.json({ success: true, message: 'Updated successfully' });\n  } catch (error) {\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\n  }\n}\n\nexport async function DELETE(request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const id = searchParams.get('id');\n\n    if (!id) {\n      return NextResponse.json({ success: false, message: 'ID required' }, { status: 400 });\n    }\n\n    await query('DELETE FROM cms_news WHERE id = ?', [id]);\n\n    revalidatePath('/');\n    return NextResponse.json({ success: true, message: 'Deleted successfully' });\n  } catch (error) {\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAO;IAC/B,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;QAE9B,IAAI,MAAM;YACR,MAAM,SAAS,MAAM,IAAA,oHAAK,EAAC,yCAAyC;gBAAC;aAAK;YAC1E,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAM,MAAM,MAAM,CAAC,EAAE;YAAC;QAC5D;QAEA,MAAM,OAAO,MAAM,IAAA,oHAAK,EAAC;QACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAK;IACjD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,WAAW,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG;QAElF,MAAM,SAAS,MAAM,IAAA,oHAAK,EACxB,gIACA;YAAC;YAAO,QAAQ;YAAI;YAAa,WAAW;YAAM;YAAM;YAAU;YAAO;SAAY;QAGvF,IAAA,iJAAc,EAAC;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;YAAsB,IAAI,OAAO,QAAQ;QAAC;IAC/F,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF;AAEO,eAAe,IAAI,OAAO;IAC/B,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,WAAW,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG;QAEtF,MAAM,IAAA,oHAAK,EACT,wHACA;YAAC;YAAO,QAAQ;YAAI;YAAa,WAAW;YAAM;YAAM;YAAU;YAAO;YAAa;SAAG;QAG3F,IAAA,iJAAc,EAAC;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAuB;IAC5E,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF;AAEO,eAAe,OAAO,OAAO;IAClC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,KAAK,aAAa,GAAG,CAAC;QAE5B,IAAI,CAAC,IAAI;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,MAAM,IAAA,oHAAK,EAAC,qCAAqC;YAAC;SAAG;QAErD,IAAA,iJAAc,EAAC;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAuB;IAC5E,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF"}}]
}