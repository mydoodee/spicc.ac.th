{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo11/Desktop/xx/spicc.ac.th-main/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\r\n// Ensure mysql2 is used as a server-only package\r\n\r\nlet pool = global.dbPool || null;\r\n\r\nfunction getPool() {\r\n    if (!pool) {\r\n        pool = mysql.createPool({\r\n            host: process.env.DB_HOST,\r\n            user: process.env.DB_USER,\r\n            password: process.env.DB_PASSWORD,\r\n            database: process.env.DB_NAME,\r\n            port: parseInt(process.env.DB_PORT || '3306'),\r\n            waitForConnections: true,\r\n            connectionLimit: 10,\r\n            queueLimit: 0,\r\n            connectTimeout: 30000,\r\n            enableKeepAlive: true,\r\n            keepAliveInitialDelay: 0,\r\n            charset: 'utf8mb4',\r\n        });\r\n        global.dbPool = pool;\r\n    }\r\n    return pool;\r\n}\r\n\r\nexport async function query(sql, params = []) {\r\n    const pool = getPool();\r\n    const [rows] = await pool.execute(sql, params);\r\n    return rows;\r\n}\r\n\r\nexport default getPool;\r\n"],"names":[],"mappings":";;;;;;AAAA;;AACA,iDAAiD;AAEjD,IAAI,OAAO,yDAAO,MAAM,IAAI;AAE5B,SAAS;IACL,IAAI,CAAC,MAAM;QACP,OAAO,mLAAK,CAAC,UAAU,CAAC;YACpB,MAAM,QAAQ,GAAG,CAAC,OAAO;YACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;YACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;YACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;YAC7B,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;YACtC,oBAAoB;YACpB,iBAAiB;YACjB,YAAY;YACZ,gBAAgB;YAChB,iBAAiB;YACjB,uBAAuB;YACvB,SAAS;QACb;QACA,yDAAO,MAAM,GAAG;IACpB;IACA,OAAO;AACX;AAEO,eAAe,MAAM,GAAG,EAAE,SAAS,EAAE;IACxC,MAAM,OAAO;IACb,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,OAAO,CAAC,KAAK;IACvC,OAAO;AACX;uCAEe"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo11/Desktop/xx/spicc.ac.th-main/app/api/courses/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { query } from '@/lib/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function GET(request) {\r\n    try {\r\n        const { searchParams } = new URL(request.url);\r\n        const id = searchParams.get('id');\r\n        const slug = searchParams.get('slug');\r\n\r\n        if (id) {\r\n            const result = await query('SELECT * FROM cms_courses WHERE id = ?', [id]);\r\n            return NextResponse.json({ success: true, course: result[0] });\r\n        }\r\n\r\n        if (slug) {\r\n            const result = await query('SELECT * FROM cms_courses WHERE slug = ?', [slug]);\r\n            return NextResponse.json({ success: true, course: result[0] });\r\n        }\r\n\r\n        const result = await query('SELECT * FROM cms_courses ORDER BY sort_order ASC');\r\n        return NextResponse.json({ success: true, courses: result });\r\n    } catch (error) {\r\n        console.error('GET /api/courses Error Details:', {\r\n            message: error.message,\r\n            stack: error.stack\r\n        });\r\n        return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(request) {\r\n    try {\r\n        const body = await request.json();\r\n        const { title, slug, description, image, icon, color, text_color, is_special, sort_order, show_on_home } = body;\r\n\r\n        const result = await query(\r\n            'INSERT INTO cms_courses (title, slug, description, image, icon, color, text_color, is_special, sort_order, is_active, show_on_home) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)',\r\n            [title || '', slug || '', description || '', image || null, icon || 'school', color || 'bg-[#2b4a8a]', text_color || 'text-white', is_special ? 1 : 0, sort_order || 0, 1, show_on_home ? 1 : 0]\r\n        );\r\n\r\n        revalidatePath('/');\r\n        revalidatePath('/courses');\r\n        return NextResponse.json({ success: true, message: 'Added successfully', id: result.insertId });\r\n    } catch (error) {\r\n        console.error('POST /api/courses Error:', error);\r\n        return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function PUT(request) {\r\n    try {\r\n        const body = await request.json();\r\n        console.log('PUT /api/courses Payload Keys:', Object.keys(body));\r\n        if (body.image) console.log('PUT /api/courses Image Size:', body.image.length);\r\n\r\n        const { id, title, slug, description, image, icon, color, text_color, is_special, sort_order, is_active, show_on_home } = body;\r\n\r\n        if (!id) {\r\n            return NextResponse.json({ success: false, error: 'ID is required' }, { status: 400 });\r\n        }\r\n\r\n        await query(\r\n            'UPDATE cms_courses SET title=?, slug=?, description=?, image=?, icon=?, color=?, text_color=?, is_special=?, sort_order=?, is_active=?, show_on_home=? WHERE id=?',\r\n            [title || '', slug || '', description || '', image || null, icon || 'school', color || 'bg-[#2b4a8a]', text_color || 'text-white', is_special ? 1 : 0, sort_order || 0, is_active === false ? 0 : 1, show_on_home ? 1 : 0, id]\r\n        );\r\n\r\n        revalidatePath('/');\r\n        revalidatePath('/courses');\r\n        return NextResponse.json({ success: true, message: 'Updated successfully' });\r\n    } catch (error) {\r\n        console.error('PUT /api/courses Error Details:', {\r\n            message: error.message,\r\n            code: error.code,\r\n            errno: error.errno,\r\n            sqlState: error.sqlState,\r\n            sqlMessage: error.sqlMessage\r\n        });\r\n        return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function DELETE(request) {\r\n    try {\r\n        const { searchParams } = new URL(request.url);\r\n        const id = searchParams.get('id');\r\n\r\n        if (!id) {\r\n            return NextResponse.json({ success: false, error: 'ID is required' }, { status: 400 });\r\n        }\r\n\r\n        await query('DELETE FROM cms_courses WHERE id = ?', [id]);\r\n\r\n        revalidatePath('/');\r\n        revalidatePath('/courses');\r\n        return NextResponse.json({ success: true, message: 'Deleted successfully' });\r\n    } catch (error) {\r\n        console.error('DELETE /api/courses Error:', error);\r\n        return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}